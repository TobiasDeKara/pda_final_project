---
title: "Replication and Extension of Analyses Regarding Effects of Highly Restrictive Abortion Policies"
output: pdf_document
---
## Abstract
### Importance
In the United States, many state legislatures have enacted a range of laws limiting access to abortions.  These laws limit access to crucial healthcare and have impacts on mortality, fertility, and birth rates across the country.

### Objectives
To replicate the analysis of the association of abortion restrictions on abortion rates conducted by Brown et al. (2020), though not from a longitudinal perspective, to expand the analysis to a wider data set, and to extend the analysis to associations with maternal, fetal and infant mortality rates, as well as birth and fertility rates.

### Design, Setting, and Particpants
This study examined all publicly available county-level abortion rates in addition to state-level maternal, fetal and infant mortality rates as well as birth and fertility rates from the year 2010. The association between these rates, abortion legislation, and distance to nearest provider were evaluated using propensity score adjusted linear regression.

### Exposures
In the replication, the exposures are state-level highly restrictive abortion legislation as defined by 3 or more out of 4 common types of abortion restrictions and county-level distance to facilities performing abortions (in miles).  For the extension, the exposures are the number of types of abortion legislation and the state-level average distance to facilities performing abortion (in miles). 

### Main Outcomes and Measures
In the replication and extension, the main outcomes and measures were county level abortion rates defined as abortions per 1,000 women per year.  In the extension, the main outcomes and measures were state level fetal mortality rates defined as fetal deaths per 1,000 total deaths, infant mortality rates defined as infant deaths within the first year of life per 1,000 births, maternal mortality rates defined as deaths due to maternal diseases per 1,000 total deaths, birth rates defined as number of live births per 1,000 people, and fertility rates defined as number of live births per 1,000 women per year.

### Results
Our replication confirms the primary result of Brown et al. (2020). We found that highly restrictive legislation is associated with 0.814 fewer abortions per 1,000 women without adjusting for distance to providers, and 0.649 fewer abortions per 1,000 women when adjusting for distances to providers.  These effects are somewhat larger in magnitude than the effects calculated by Brown et al., which were -0.48 (95% CI, -0.92 to -0.04) and -0.44 (95% CI, -0.85 to -0.03), but our estimates were well within their reported 95% confidence intervals. Infant mortality rates were positively associated with abortion restrictions, and these associations were statistically significant even after adjusting for distance from providers. The maternal and fetal mortality rates as well as the birth rates were not statistically significant after adjusting for distance from providers. 

### Conclusions and Relevance
Our analysis confirms the results of Brown et al. showing a negative association between restrictive abortion legislation and abortion rates based on both the 18 states they analyized and based on data from all 50 states.  We furthered the analysis to additional outcomes and found positive associations between restrictions and infant death rates, while restrictions do not have a significant association with birth rates or maternal or fetal mortality rates after adjusting for distance to providers.

## Introduction

In this paper we replicate and extend an analysis published in JAMA Network Open by Benjamin P. Brown, MD, MS; Luciana E. Hebert, PhD; Melissa Gilliam, MD, MPH;  and Robert Kaestner, PhD, entitled "Association of Highly Restrictive State Abortion Policies With Abortion Rates, 2000-2014."  Brown et al. use a binary classification of state legislative climates on abortion as either "highly restrictive" or not, and they assess the association with abortion rates using propensity weighted linear difference in differences models, based on longitudinal data from 18 states.

We first reproduce the analysis of Brown et al. using data from the same 18 states.  The data set from the Brown et al. article was not made public, and due to limitations of publicly available data, we have narrowed the scope of our replication to analyzing a single year. Specifically we analyzed data from 2010, primarily because this was the year within the original paper's time range for which we had the most detailed information on state legislation restricting abortions. Limitations of Brown et al.'s research included a lack of data on abortion rates in multiple states and a seemingly arbitrary classificaton of low vs. high legislative abortion restrictions. In order to improve the reliability and generalizability of their results, we chose to expand their analysis by using data from all 50 states, by using a more flexible integer variable for the extent of abortion restriction legislation in order, and by incorporating percentage of college graduates in the propensity score calculation. 

The original study addresses the immediate, intended consequences of the restrictive abortion legislation.  In our paper, we extend the analysis to include associations of restrictive abortion legislation with fetal mortality, infant mortality, birth rate and fertility rate.  Restricted access to abortion has been linked to adverse outcomes for mothers and children, including pre-term birth and low birth weight (Redd et al., 2021), infant mortality rates (Edwards, 2019), and maternal mortality (Stevenson, 2021).  However, the effects of abortion legislation on these health outcomes are less well understood than the direct effect on number of abortions.  The key findings of a meta-analysis on the effects of targeted restrictions on abortion providers (TRAP) were that "Certain TRAP laws may be associated with a decrease in state-level abortion rates" and "Additional research is required to better understand the impact of these laws on women’s health outcomes." (Austin and Harper, 2017)  We attempt to address this needd in the existing literature by adapting the methodology of Brown et al. to quantify the health impacts of restrictive abortion legislation.  We also measure the association of these laws on birth rates, as restrictions on abortion have in some cases been promoted as an antedote to declining birth rates, recently in eastern Europe (Nikolova, 2020). Findings regarding whether restrictions on abortion actually increase birth rates, even if they decrease abortion rates, would therefore have important policy implications.


## Study Design

In our replication, we used propensity weighted linear models to assess the association of restrictive abortion legislation and abortion rates, using data from the same set of 18 states as Brown et al. (see Table 1).  We used propensity weighting to account for differences between those states and the other 32 states based on the same set of county level covariates as Brown et al.: number of women, percentages of population by race, median household income, and percentage of voters who voted for the Democratic presidential candidate in 2008 (the most recent presidential election in 2010). We fit linear models with and without distances to abortion providers and an interaction term between those distances and restrictive legislation as well as linear models with distance to abortion providers as the outcome to assess the relationship between restrictive legislation and acess to care.

## Participants, Variables and Data Sources

We used abortion count data compiled by Wm. Robert Johnston, available at www.johnstonsarchive.net/policy/abortion.  Abortion rates were calculated as number of abortions per female population. At least partial data was available for all 18 of the states included in the analysis by Brown et al., and for most of those states there was data for more than 80% of the counties (see Table 1).  The percentages of counties reporting were similar to the percentages reporting in Brown et al. (see their Table 1).

For assessment of state legislation restricting abortion, we used data from the Guttmacher Institute, which identified states with laws of the same four types used by Brown et al.: gestational age restrictions, TRAP laws, requirements for patients to make at least two trips to a clinic, and mandated parental involvement for patients who are minors. Following Brown et al.'s methodology, we classified states as "highly restrictive" if they had 3 or 4 of these types of laws. 

We estimated distances to providers as the straight-line distances from the population centroids of counties of residence (courtesy of the United States Census Bureau) to the location of the nearest abortion clinic (courtesy of Safe Place Project). 

Data on the percentage of democratic votes by county in the most recent (2008) presidential election was retrieved from the Harvard Dataverse.

For the extension, data on state-level maternal, fetal and infant mortality rates as well as birth and fertility rates from the year 2010 were retrieved from the Centers for Disease Control and Prevention (CDC) WONDER Online Database. State-level rates were used as opposed to county-level rates because more than 80% of these county-level rates were either suppressed or missing to maintain anonymity. 

## Results

### Replication using data from 18 states

The distribution of propensity scores for counties in states included in the analysis was similar to that for counties in states not included (see Figure 1).  This suggests that the 18 states included in the analysis are not exceptionally different from those not included (in terms the demographic covariates listed above), and accordingly we expect the propensity weights to accurately adjust for the differences.

Tables 3 and 4 show the main results from our replication.  Without adjusting for distances to providers, we found that highly restrictive legislation was associated with a fewer abortions at a rate of -0.814 per 1,000 women without adjusting for distance to providers, and -0.649 when adjusting for distances to providers.  These effects are somewhat larger in magnitude than the effects calculated by Brown et al., which were -0.48 (95% CI, -0.92 to -0.04) and -0.44 (95% CI, -0.85 to -0.03), but our estimates were well within their reported 95% confidence intervals (see Brown et al. Table 3).  This corroborates the main result of Brown et al. despite the use of completely different data sources.

We did observe a decrease in abortion rates based on estimated distances to abortion providers.  This decrease was statistically significant significant at -0.00554 abortions per 1,000 women (see Table 4), compared to -0.02 in the analysis by Brown et al.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#load packages
options(tidyverse.quiet=TRUE)
library(tidyverse)
library(readxl)
library(dplyr)
library(geosphere)
library(stringr)
library(kableExtra)
library(table1)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#load in relevant data
providers <- read.csv("data/provider_list_geo.csv")
countycentroids <- read.csv("data/county_pop_centroids.csv")
countydem <- read.csv("data/county_demographics.csv")
abortions <- read.csv("data/cleanedabortiondata.csv")
restrictions <- read.csv("data/state_restrictions2010.csv")
countypres <- read.csv("data/countypres.csv")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
########### clean county dem data ###########
countydem <- read.csv("data/county_demographics.csv")

for (i in 1:nrow(countydem)) {
  countydem$state[i] <- unlist(strsplit(countydem$NAME[i], ", "))[length(unlist(strsplit(countydem$NAME[i], ", ")))]
}

countydem$county <- gsub(countydem$NAME, pattern = ", [[:print:]]*$", replacement = "")
countydem$county <- gsub(countydem$county, pattern = " County", replacement = "")

countydem <- countydem %>% filter(countydem$state %in% state.name)

for (i in 1:nrow(countydem)) {
  countydem$state.abb[i] <- state.abb[which(state.name == countydem$state[i])]
}

countydem$county <- str_to_title(countydem$county)
countydem$county <- gsub(countydem$county, pattern = "Doña Ana", replacement = "Dona Ana")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
########### calculate abortion rates in 2010 ###########

#filter abortion rate data to only 2010
abortions2010 <- abortions %>% dplyr::select(state, county, X2010)

# length(unique(abortions2010$state)) #only 42 states in abortion data

#look at percent missing abortion counts by state
# aggregate(X2010 ~ state, data = abortions2010, function(x) {sum(!(is.na(x)))/length(x)}, na.action = NULL)

# clean abortion data to make counties and states match county dem data
abortions2010$county <- str_to_title(abortions2010$county)
abortions2010$county <- gsub(abortions2010$county, pattern = "[()]", replacement = "")
abortions2010$county <- gsub(abortions2010$county, pattern = "Ind. City", replacement = "City")
abortions2010$county <- gsub(abortions2010$county, pattern = "Saint", replacement = "St.")
abortions2010$county <- gsub(abortions2010$county, pattern = "Miami Dade", replacement = "Miami-Dade")
abortions2010$county <- gsub(abortions2010$county, pattern = "Hawai'i", replacement = "Hawaii")
abortions2010$county <- gsub(abortions2010$county, pattern = "Kaua'i", replacement = "Kauai")
abortions2010$county <- gsub(abortions2010$county, pattern = "St.e Genevieve", replacement = "Ste. Genevieve")
abortions2010$county <- gsub(abortions2010$county, pattern = "Shannon/Oglala Lakota", replacement = "Oglala Lakota")

#fix NA values and make abortion counts numeric
abortions2010$X2010 <- na_if(abortions2010$X2010, "?")
abortions2010$X2010 <- na_if(abortions2010$X2010, "")
abortions2010$X2010 <- as.numeric(abortions2010$X2010)

#remove non-counties
abortions2010 <- abortions2010 %>% filter(!(county %in% c("Nonresidents", "Protected", "Other States", "Other Countries", "Non-Residents", "Other", "Nevada Protected", "Nevada Unspecified", "Nebraska Protected", "County", "Maryland")))

#look at counties in abortion data but not countydem data
# abortions2010$county[!(abortions2010$county %in% countydem$county)]
#"St. Louis County", "Bedford City", "Clifton Forge City"

#look at counties in countydem data but not abortion data
# countydem$county[!(countydem$county %in% abortions2010$county)] #many 
# unique(countydem$state.abb[!(countydem$state.abb %in% abortions2010$state)]) #"AK" "CT" "IA" "LA" "MA" "NH" "NM" "WY"

#Add abortion counts to county data
for (i in 1:nrow(countydem)) {
  if (length(abortions2010$X2010[abortions2010$state == countydem$state.abb[i] & abortions2010$county == countydem$county[i]]) == 0) {
    countydem$AbortionCount2010[i] <- NA
  }
  else {
    countydem$AbortionCount2010[i] <- abortions2010$X2010[abortions2010$state == countydem$state.abb[i] & abortions2010$county == countydem$county[i]]
  }
}

#calculate abortion rates
countydem <- countydem %>% mutate(AbortionRate2010 = AbortionCount2010/Women)

#look at percent missing abortion rates by state
# aggregate(AbortionRate2010 ~ state, data = countydem, function(x) {sum(!(is.na(x)))/length(x)}, na.action = NULL)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
########### calculate percent democratic votes by county in in 2008 ###########
countypresdem2008 <- countypres %>% filter(party == "DEMOCRAT" & year == 2008)
countypresdem2008$county_name <- str_to_title(countypresdem2008$county_name)

countydem$county <- gsub(countydem$county, pattern = " Parish", replacement = "")
countydem$county <- gsub(countydem$county, pattern = " City", replacement = "")
countypresdem2008$county_name <- gsub(countypresdem2008$county_name, pattern = " City", replacement = "")
countypresdem2008$county_name <- gsub(countypresdem2008$county_name, pattern = "Saint", replacement = "St.")
countypresdem2008$county_name <- gsub(countypresdem2008$county_name, pattern = " County", replacement = "")

missingcounties <- countypresdem2008[!(countypresdem2008$county_name %in% countydem$county), ] #all of AK and a few others (DC, Dona Ana New Mexico, Kansas City Missouri, Maine Uocava Maine, Federal Precinct Rhode Island)

countypresdem2008 <- countypresdem2008 %>% mutate(percentdem2008 = candidatevotes/totalvotes) 
countypresdem2008 <- countypresdem2008 %>% rename(state.abb = state_po, county = county_name) %>% dplyr::select(state.abb, county, percentdem2008)

countydem <- left_join(countydem, countypresdem2008, by = c("state.abb", "county"))

#look at percent missing dem vote by state
# aggregate(percentdem2008 ~ state, data = countydem, function(x) {sum(!(is.na(x)))/length(x)}, na.action = NULL)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
########### calculate distances from county centroids to closest provider location ###########

for (i in 1:nrow(countycentroids)) {
  lat <- countycentroids$LATITUDE[i]
  long <- countycentroids$LONGITUDE[i]
  dists <- distHaversine(cbind(long, lat), cbind(providers$Lon, providers$Lat))*0.000621371
  countycentroids$distancetoprovider[i] <- min(dists)
}

countycentroids <- countycentroids %>% rename(county = COUNAME, state = STNAME)
countycentroids$county <- str_to_title(countycentroids$county)
countycentroids <- countycentroids %>% dplyr::select(county, state, distancetoprovider)
countycentroids <- countycentroids %>% filter(state != "Puerto Rico")
countycentroids$county <- gsub(countycentroids$county, pattern = " City", replacement = "")

missingcounties <- countycentroids[!(countycentroids$county %in% countydem$county), ] #Alaska and DC

countydem <- left_join(countydem, countycentroids, by = c("state", "county"))

#look at percent missing distance by state
# aggregate(distancetoprovider ~ state, data = countydem, function(x) {sum(!(is.na(x)))/length(x)}, na.action = NULL)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#make new variable for high vs. low restrictions
restrictions <- restrictions %>% mutate(totalrestrict = parental_involvement + two_trips + trap + unconstitutional_ban, 
                                        restrictionlevel = case_when(totalrestrict >= 3 ~ "high", 
                                                              totalrestrict < 3 ~ "low"))
# restrictions$state[!(restrictions$state %in% countydem$state)] #none
countydem <- left_join(countydem, restrictions, by = "state")
countydem$restrictionlevel <- factor(countydem$restrictionlevel, levels = c("low", "high"))

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#look at demographics

countydem <- countydem %>% mutate(inanalysis = case_when(state.abb %in% c("AZ", "DE", "GA", "IL", "IN", "MI", "NY", "NC", "OH", "OK", "OR", "PA", "SC", "TX", "UT", "VT", "WA", "WI") ~ 1, !(state.abb %in% c("AZ", "DE", "GA", "IL", "IN", "MI", "NY", "NC", "OH", "OK", "OR", "PA", "SC", "TX", "UT", "VT", "WA", "WI")) ~ 0))

countydemanalysis <- countydem %>% filter(inanalysis == 1)

table_1 <- countydemanalysis %>% group_by(state) %>% summarize(totalcounties = n())
usedcounties <- aggregate(AbortionRate2010 ~ state, data = countydemanalysis, function(x) {sum(!(is.na(x)))}, na.action = NULL)
table_1 <- left_join(table_1, usedcounties, by = "state")
table_1 %>% mutate(percent = AbortionRate2010/totalcounties) %>% kbl(col.names = c("State", "Total Counties", "Counties with Abortion Data in 2010", "Percent"), caption = "Number of Counties with Abortion Data Included in Analyses by State", digits = 3) %>% kable_styling(latex_options = 'hold_position')

```


```{r echo=FALSE, message=FALSE, warning=FALSE}
```{r echo=FALSE, message=FALSE, warning=FALSE}
##### Table 2 ####

countydem <- countydem %>% mutate(Total = White + Black + Native.American + Asian + Hispanic, White.pct = White/Total, Black.pct = Black/Total, Native.American.pct = Native.American/Total, Asian.pct = Asian/Total, Hispanic.pct = Hispanic/Total, College.Grad.pct = College.Grad/Total)

countydem$inanalysislabel <- factor(countydem$inanalysis, levels = c(1, 0), labels = c("In Analysis", "Not in Analysis"))

countydem$countyinanalysis <- ifelse(countydem$inanalysis == 1 & !is.na(countydem$AbortionRate2010), 1, 0) 
countydem$countyinanalysislabel <- factor(countydem$countyinanalysis, levels = c(1, 0), labels = c("In Analysis", "Not in Analysis"))

countydem$csinanalysis <- ifelse(sum(countydem$inanalysis + countydem$countyinanalysis) == 2, 1, 0)

# The following function is based on 
# "Using the table1 Package to Create HTML Tables of Descriptive Statistics"
# by Benjamin Rich.  Available at:
# https://cran.r-project.org/web/packages/table1/vignettes/table1-examples.html#example-a-column-of-p-values
p_value_t_test <- function(x, ...){
    y <- unlist(x[1:2])
    g <- factor(rep(1:length(x[1:2]), times=sapply(x[1:2], length)))
    p <- t.test(y ~ g)$p.value  %>% round(3) 
    c("", sub("<", "<", format.pval(p, digits=3, eps=0.001)))
}

statesummarydata <- countydem %>% filter(csinanalysis != 2) %>% group_by(state) %>% summarize(Women = mean(Women, na.rm = TRUE), White.pct = mean(White.pct, na.rm = TRUE), Black.pct = mean(Black.pct, na.rm = TRUE), Native.American.pct = mean(Native.American.pct, na.rm = TRUE), Asian.pct = mean(Asian.pct, na.rm = TRUE), Hispanic.pct = mean(Hispanic.pct, na.rm = TRUE), College.Grad.pct = mean(College.Grad.pct, na.rm = TRUE), Median.Income = mean(Median.Income, na.rm = TRUE), percentdem2008 = mean(percentdem2008, na.rm = TRUE), AvgDistancetoProvider = mean(distancetoprovider, na.rm = TRUE), inanalysis = mean(inanalysis, na.rm = TRUE))

statesummarydata$inanalysislabel <- factor(statesummarydata$inanalysis, levels = c(1, 0), labels = c("In Analysis", "Not in Analysis"))

label(statesummarydata$Women) = "Women"
label(statesummarydata$White.pct) = "White"
label(statesummarydata$Black.pct) = "Black"
label(statesummarydata$Native.American.pct) = "Native American"
label(statesummarydata$Asian.pct) = "Asian"
label(statesummarydata$Hispanic.pct) = "Hispanic"
label(statesummarydata$Median.Income) = "Median Income"
label(statesummarydata$College.Grad.pct) = "College Graduates"
label(statesummarydata$percentdem2008) = "Vote Democratic"

units(statesummarydata$Women) = "No."
units(statesummarydata$White.pct) = "%"
units(statesummarydata$Black.pct) = "%"
units(statesummarydata$Native.American.pct) = "%"
units(statesummarydata$Asian.pct) = "%"
units(statesummarydata$Hispanic.pct) = "%"
units(statesummarydata$Median.Income) = "$"
units(statesummarydata$College.Grad.pct) = "%"
units(statesummarydata$percentdem2008) = "%"

## Table 2 ###
table1(~ Women + White.pct + Black.pct + Native.American.pct + Asian.pct + Hispanic.pct + Median.Income + College.Grad.pct + percentdem2008 | inanalysislabel, 
       data = statesummarydata,
       overall = FALSE,
       extra.col = list(`P-value` = p_value_t_test),
       extra.col.pos = 3,
       footnote = 'P-values are derived by two sample t-tests.',
       caption = "County Data for States Included and Not Included in Analysis"
       )
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=5, fig.align='center'}
#calculate propensity scores
propensitywts <- glm(inanalysis ~ Black.pct + Native.American.pct + Asian.pct + Hispanic.pct + Median.Income + Women + percentdem2008, data=countydem, family=binomial())
# summary(propensitywts)

p.score <- predict(propensitywts, countydem, type = "response")
df <- countydem
df$ps <- p.score

# plot of distribution of propensity scores 
ggplot(df, aes(x = ps, group = inanalysislabel)) + geom_density(aes(fill = inanalysislabel), alpha = 0.2) +
  xlab('Probability of Being in the Analysis') +
  ggtitle('Figure 1: Propensity Score Distribution by Group') +
  scale_fill_discrete('') +
  theme(legend.position = 'bottom', legend.direction = 'vertical') +
  ylab("Density")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#run models
countydemanalysis <- df %>% filter(inanalysis == 1)

model_no_dist <- lm(AbortionRate2010 ~ restrictionlevel, data = countydemanalysis, weights = ps)
summ_no_dist <- summary(model_no_dist)

model_dist <- lm(AbortionRate2010 ~ restrictionlevel + distancetoprovider + restrictionlevel*distancetoprovider, data = countydemanalysis, weights = ps)
summ_dist <- summary(model_dist)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Model Summaries (Note coefficients are per 1000 women)
table_3 <- tibble(Characteristic = "Highly Restrictive Legislation",
                  Beta = summ_no_dist$coefficients[2,1]*1000,
                  "95% CI lower" = summ_no_dist$coefficients[2,1]*1000-summ_no_dist$coefficients[2,2]*1000*1.96,
                  "95% CI upper" = summ_no_dist$coefficients[2,1]*1000+summ_no_dist$coefficients[2,2]*1000*1.96,
                  "p-value" = '< 0.001') %>% 
  kbl(caption = "Change in Abortions per 1000 Women in Model without Distances", 
          digits = 3) %>%
  kable_styling(latex_options = 'hold_position')
table_3
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
p <- summ_dist$coefficients[4,4] %>% round(3)
table_4 <- tibble(Characteristic = c("Highly Restrictive Legislation", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2]*1000, 
                           model_dist$coefficients[3]*1000,
                           model_dist$coefficients[4]*1000),
                  "95% CI lower" = c(summ_dist$coefficients[2,1]*1000-summ_dist$coefficients[2,2]*1000*1.96,
                                     summ_dist$coefficients[3,1]*1000-summ_dist$coefficients[3,2]*1000*1.96,
                                     summ_dist$coefficients[4,1]*1000-summ_dist$coefficients[4,2]*1000*1.96),
                  "95% CI upper" = c(summ_dist$coefficients[2,1]*1000+summ_dist$coefficients[2,2]*1000*1.96,
                                     summ_dist$coefficients[3,1]*1000+summ_dist$coefficients[3,2]*1000*1.96,
                                     summ_dist$coefficients[4,1]*1000+summ_dist$coefficients[4,2]*1000*1.96),
                  "p-value" = c('< 0.001', '< 0.001', p)) %>%
  kbl(caption = "Change in Abortions per 1000 Women in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_4

###### End of Replication ######
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#### Begin Extension #####
####### add in natality, maternalmortality, and infantdeath data #######
natality <- read.delim("data/natalitydata.txt")
maternalmortality <- read.delim("data/maternalmortality.txt")
infantdeath <- read.delim("data/infantdeathrecords.txt")

infantdeath$County <- gsub(infantdeath$County, pattern = ", [[:print:]]*$", replacement = "")
infantdeath$County <- gsub(infantdeath$County, pattern = " County", replacement = "")
infantdeath$County <- str_to_title(infantdeath$County)
infantdeath$County <- na_if(infantdeath$County, "")
infantdeath <- infantdeath %>% filter(County != "Unidentified Counties")
infantdeath$County <- gsub(infantdeath$County, pattern = " Parish", replacement = "")
infantdeath$County <- gsub(infantdeath$County, pattern = "Borough", replacement = "Municipality")
infantdeath$County <- gsub(infantdeath$County, pattern = " City", replacement = "")
# infantdeath$County[!(infantdeath$County %in% countydem$county)]
infantdeath <- infantdeath %>% rename(state = State, county = County, infantdeathrate = Death.Rate)
infantdeath <- infantdeath %>% dplyr::select(state, county, infantdeathrate)

maternalmortality$County <- gsub(maternalmortality$County, pattern = ", [[:print:]]*$", replacement = "")
maternalmortality$County <- gsub(maternalmortality$County, pattern = " County", replacement = "")
maternalmortality$County <- str_to_title(maternalmortality$County)
maternalmortality$County <- na_if(maternalmortality$County, "")
maternalmortality <- maternalmortality %>% filter(County != "Unidentified Counties")
maternalmortality$County <- gsub(maternalmortality$County, pattern = " Parish", replacement = "")
maternalmortality$County <- gsub(maternalmortality$County, pattern = "Borough", replacement = "Municipality")
maternalmortality$County <- gsub(maternalmortality$County, pattern = " City", replacement = "")
maternalmortality$County <- gsub(maternalmortality$County, pattern = "La Porte", replacement = "Laporte")
maternalmortality$County <- gsub(maternalmortality$County, pattern = "De Kalb", replacement = "Dekalb")
maternalmortality$County <- gsub(maternalmortality$County, pattern = "Mc Kean", replacement = "Mckean")
maternalmortality$County[!(maternalmortality$County %in% countydem$county)] <- gsub(maternalmortality$County[!(maternalmortality$County %in% countydem$county)], pattern = "Municipality", replacement = "Borough")
maternalmortality$County[!(maternalmortality$County %in% countydem$county)] <- gsub(maternalmortality$County[!(maternalmortality$County %in% countydem$county)], pattern = "Borough", replacement = "And Borough")
maternalmortality$County[!(maternalmortality$County %in% countydem$county)] <- gsub(maternalmortality$County[!(maternalmortality$County %in% countydem$county)], pattern = "/", replacement = " ")
maternalmortality$County[!(maternalmortality$County %in% countydem$county)] <- gsub(maternalmortality$County[!(maternalmortality$County %in% countydem$county)], pattern = " Census Area", replacement = "")
maternalmortality$County[!(maternalmortality$County %in% countydem$county)] <- gsub(maternalmortality$County[!(maternalmortality$County %in% countydem$county)], pattern = " And", replacement = "")
# maternalmortality$County[!(maternalmortality$County %in% countydem$county)]

maternalmortality <- maternalmortality %>% rename(state = State, county = County, maternaldeaths = Deaths, maternaldeathrate = Crude.Rate)
maternalmortality <- maternalmortality %>% dplyr::select(state, county, maternaldeathrate)

natality$County <- gsub(natality$County, pattern = ", [[:print:]]*$", replacement = "")
natality$County <- gsub(natality$County, pattern = " County", replacement = "")
natality$County <- str_to_title(natality$County)
natality$County <- na_if(natality$County, "")
natality <- natality %>% filter(County != "Unidentified Counties")
natality$County <- gsub(natality$County, pattern = " Parish", replacement = "")
natality$County <- gsub(natality$County, pattern = "Borough", replacement = "Municipality")
natality$County <- gsub(natality$County, pattern = " City", replacement = "")
natality$County <- gsub(natality$County, pattern = "La Porte", replacement = "Laporte")
# natality$County[!(natality$County %in% countydem$county)]
natality <- natality %>% rename(state = State, county = County)
natality <- natality %>% dplyr::select(state, county, Birth.Rate, Fertility.Rate)

countydem <- left_join(countydem, infantdeath, by = c("state", "county"))
countydem <- left_join(countydem, maternalmortality, by = c("state", "county"))
countydem <- left_join(countydem, natality, by = c("state", "county"))

# sum(is.na(countydem$infantdeathrate)/nrow(countydem))
countydem$maternaldeathrate <- na_if(countydem$maternaldeathrate, "Suppressed")
countydem$maternaldeathrate <- na_if(countydem$maternaldeathrate, "Missing")

# sum(is.na(countydem$maternaldeathrate)/nrow(countydem))
# sum(is.na(countydem$Birth.Rate)/nrow(countydem))

```
### Expansion to Data from All States

When we repeated the analysis using all data available in all 50 states, we measured a significant reduction in the abortion rate, with associations per type of restriction in place of -0.216 and -0.361 without and with adjustment for distance to providers (see Tables 5 and 6).  These results align with the results of Brown et al. and the results of our replication, and suggest that the propensity score weighting from the 18 states in their analysis to the entire country is accurately accounting for differences between those 18 states and the others.  We repeated the analysis of abortion rate using state level data from all states(see Tables 7 and 8), and found stronger but comparable associations, further confirming the primary results of Brown et al.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
#### recode restriction level and include all counties with abortion data in analysis ####
countyanalysis <- function(varname) {
  countydem <- countydem %>% mutate(hasdata = case_when(is.na(countydem[[varname]]) ~ 0, 
                                                              !(is.na(countydem[[varname]])) ~ 1))
  countydemanalysis <- countydem %>% filter(hasdata == 1)
  summarytable <- countydem %>% group_by(state) %>% summarize(totalcounties = n())
  usedcounties <- aggregate(countydem[[varname]] ~ state, data = countydem, function(x) {sum(!(is.na(x)))}, na.action = NULL)
  summarytable <- left_join(summarytable, usedcounties, by = "state")
  summarytable <- summarytable %>% mutate(percent = summarytable[, 3]/totalcounties) %>% 
    kbl(col.names = c("State", "Total Counties", "Counties with Data in 2010", "Percent"), 
        caption = "Number of Counties with Data Included in Analysis by State") %>% 
    kable_styling(latex_options = 'hold_position')
  
  countydem$hasdatalabel <- factor(countydem$hasdata, levels = c(1, 0), labels = c("Counties in States With Data", "Counties in States Without Data"))

  label(countydem$Women) = "Women"
  label(countydem$White.pct) = "White"
  label(countydem$Black.pct) = "Black"
  label(countydem$Native.American.pct) = "Native American"
  label(countydem$Asian.pct) = "Asian"
  label(countydem$Hispanic.pct) = "Hispanic"
  label(countydem$Median.Income) = "Median Income"
  label(countydem$College.Grad.pct) = "College Graduates"
  label(countydem$percentdem2008) = "Voting for the Democratic candidate in the most recent presidential election"

  units(countydem$Women) = "No."
  units(countydem$White.pct) = "%"
  units(countydem$Black.pct) = "%"
  units(countydem$Native.American.pct) = "%"
  units(countydem$Asian.pct) = "%"
  units(countydem$Hispanic.pct) = "%"
  units(countydem$Median.Income) = "$"
  units(countydem$College.Grad.pct) = "%"
  units(countydem$percentdem2008) = "%"
  
  #calculate propensity scores
  #include education this time
  propensitywts <- glm(hasdata ~ Black.pct + Native.American.pct + Asian.pct + Hispanic.pct + Median.Income + Women + percentdem2008 + College.Grad.pct, data=countydem, family=binomial())

  p.score <- predict(propensitywts, countydem, type = "response")
  df <- countydem
  df$ps <- p.score
  
  #run model
  countydemanalysis <- df %>% filter(hasdata == 1)
  model_no_dist <- lm(countydemanalysis[[varname]] ~ totalrestrict, data = countydemanalysis, weights = ps)
  
  model_dist <- lm(countydemanalysis[[varname]] ~ totalrestrict + distancetoprovider + totalrestrict*distancetoprovider, data = countydemanalysis, weights = ps)
  return(list(summary(model_no_dist), summary(model_dist), summarytable))
}


returns <- countyanalysis("AbortionRate2010")
all_state_model_no_dist <- returns[[1]]
all_state_model_dist <- returns[[2]]

# Model Summaries (Note coefficients are per 1000 women)
# Model Summaries (Note coefficients are per 1000 women)
table_5 <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = all_state_model_no_dist$coefficients[2]*1000,
                  "95% CI lower" = all_state_model_no_dist$coefficients[2,1]*1000-all_state_model_no_dist$coefficients[2,2]*1000*1.96,
                  "95% CI upper" = all_state_model_no_dist$coefficients[2,1]*1000+all_state_model_no_dist$coefficients[2,2]*1000*1.96,
                  "p-value" = c('< 0.001')
                  ) %>% 
  kbl(caption = "Counties from All States: Change in Abortions per 1000 Women in Model without Distances", 
          digits = 3) %>%
  kable_styling(latex_options = 'hold_position')
table_5

p <- all_state_model_dist$coefficients[4,4] %>% round(3)
table_6 <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(all_state_model_dist$coefficients[2]*1000, 
                           all_state_model_dist$coefficients[3]*1000,
                           all_state_model_dist$coefficients[4]*1000),
                  "95% CI lower" = c(all_state_model_dist$coefficients[2,1]*1000-all_state_model_dist$coefficients[2,2]*1000*1.96,
                                     all_state_model_dist$coefficients[3,1]*1000-all_state_model_dist$coefficients[3,2]*1000*1.96,
                                     all_state_model_dist$coefficients[4,1]*1000-all_state_model_dist$coefficients[4,2]*1000*1.96),
                  "95% CI upper" = c(all_state_model_dist$coefficients[2,1]*1000+all_state_model_dist$coefficients[2,2]*1000*1.96,
                                     all_state_model_dist$coefficients[3,1]*1000+all_state_model_dist$coefficients[3,2]*1000*1.96,
                                     all_state_model_dist$coefficients[4,1]*1000+all_state_model_dist$coefficients[4,2]*1000*1.96),
                  "p-value" = c('< 0.001', '< 0.001', p)) %>%
  kbl(caption = "Counties from All States: Change in Abortions per 1000 Women in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_6

all_state_table <- returns[[3]]
# all_state_table # move to appendix?
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
###further clean up maternaldeathrate, infantdeathrate, birthrate, and fertilityrate data ####
countydem$maternaldeathrate <- gsub(countydem$maternaldeathrate, pattern = "[()]", replacement = "")
countydem$maternaldeathrate <- gsub(countydem$maternaldeathrate, pattern = "Unreliable", replacement = "")
countydem$maternaldeathrate <- as.numeric(countydem$maternaldeathrate)
# hist(countydem$maternaldeathrate)

countydem$infantdeathrate <- na_if(countydem$infantdeathrate, "Missing County")
countydem$infantdeathrate <- gsub(countydem$infantdeathrate, pattern = "[()]", replacement = "")
countydem$infantdeathrate <- gsub(countydem$infantdeathrate, pattern = "Unreliable", replacement = "")
countydem$infantdeathrate <- as.numeric(countydem$infantdeathrate)
# hist(countydem$infantdeathrate)

countydem$Birth.Rate <- na_if(countydem$Birth.Rate, "Missing County")
countydem$Birth.Rate <- as.numeric(countydem$Birth.Rate)
# hist(countydem$Birth.Rate)

countydem$Fertility.Rate <- na_if(countydem$Fertility.Rate, "Missing County")
countydem$Fertility.Rate <- as.numeric(countydem$Fertility.Rate)
# hist(countydem$Fertility.Rate)

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#add in state level maternaldeathrate, infantdeathrate, birthrate, and fertilityrate data ####

statelevelnatality <- read.delim("data/statelevelnatality.txt")
statelevelinfantdeaths <- read.delim("data/statelevelinfantdeaths.txt")
statelevelfetaldeaths <- read.delim("data/statelevelfetaldeaths.txt")
statelevelmaternalmortality <- read.delim("data/statelevelmaternalmortality.txt")

statelevelnatality <- statelevelnatality %>% select(State, Birth.Rate, Fertility.Rate)
statelevelinfantdeaths <- statelevelinfantdeaths %>% select(State, Death.Rate)
statelevelfetaldeaths <- statelevelfetaldeaths %>% select(Standard.Residence.States, Percent.of.Total.Deaths) %>% rename(State = Standard.Residence.States, Pct.Fetal.Deaths = Percent.of.Total.Deaths)
statelevelmaternalmortality <- statelevelmaternalmortality %>% select(State, X..of.Total.Deaths) %>% rename(Pct.Maternal.Deaths = X..of.Total.Deaths)

statedem <- countydem %>% group_by(state) %>% summarize(AvgWomen = mean(Women, na.rm = TRUE), AvgWhite.pct = mean(White.pct, na.rm = TRUE), AvgBlack.pct = mean(Black.pct, na.rm = TRUE), AvgNative.American.pct = mean(Native.American.pct, na.rm = TRUE), AvgAsian.pct = mean(Asian.pct, na.rm = TRUE), AvgHispanic.pct = mean(Hispanic.pct, na.rm = TRUE), AvgCollege.Grad.pct = mean(College.Grad.pct, na.rm = TRUE), AvgMedian.Income = mean(Median.Income, na.rm = TRUE), AvgDem2008.pct = mean(percentdem2008, na.rm = TRUE), AvgDistancetoProvider = mean(distancetoprovider, na.rm = TRUE), TotalRestrictions = mean(totalrestrict, na.rm = TRUE), AvgAbortionRate2010 = mean(AbortionRate2010, na.rm = TRUE)) %>% rename(State = state)

statedem <- left_join(statedem, statelevelnatality, by = c("State"))
statedem <- left_join(statedem, statelevelinfantdeaths , by = c("State"))
statedem <- left_join(statedem, statelevelfetaldeaths, by = c("State"))
statedem <- left_join(statedem, statelevelmaternalmortality, by = c("State"))

for (i in 1:ncol(statedem)) {
  statedem[[i]][is.nan(statedem[[i]])] <- NA
}

statedem$Pct.Maternal.Deaths <- na_if(statedem$Pct.Maternal.Deaths, "Suppressed")
statedem$Pct.Maternal.Deaths <- gsub(statedem$Pct.Maternal.Deaths, pattern = "%", replacement = "")
statedem$Pct.Maternal.Deaths <- as.numeric(statedem$Pct.Maternal.Deaths)

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
###make function for extended analysis###
stateanalysis <- function(varname) {
  statedem <- statedem %>% mutate(hasdata = case_when(is.na(statedem[[varname]]) ~ 0, 
                                                              !(is.na(statedem[[varname]])) ~ 1))
  statedemanalysis <- statedem %>% filter(hasdata == 1)
  statedem$hasdatalabel <- factor(statedem$hasdata, levels = c(1, 0), labels = c("States With Data", "States Without Data"))

  label(statedem$AvgWomen) = "Average Women"
  label(statedem$AvgWhite.pct) = "Average White"
  label(statedem$AvgBlack.pct) = "Average Black"
  label(statedem$AvgNative.American.pct) = "Average Native American"
  label(statedem$AvgAsian.pct) = "Average Asian"
  label(statedem$AvgHispanic.pct) = "Average Hispanic"
  label(statedem$AvgMedian.Income) = "Average Median Income"
  label(statedem$AvgCollege.Grad.pct) = "Average College Graduates"
  label(statedem$AvgDem2008.pct) = "Democratic Vote"

  units(statedem$AvgWomen) = "No."
  units(statedem$AvgWhite.pct) = "%"
  units(statedem$AvgBlack.pct) = "%"
  units(statedem$AvgNative.American.pct) = "%"
  units(statedem$AvgAsian.pct) = "%"
  units(statedem$AvgHispanic.pct) = "%"
  units(statedem$AvgMedian.Income) = "$"
  units(statedem$AvgCollege.Grad.pct) = "%"
  units(statedem$AvgDem2008.pct) = "%"
  
  #calculate propensity scores
  #include education this time
  propensitywts <- glm(hasdata ~ AvgWhite.pct + AvgBlack.pct + AvgNative.American.pct + AvgAsian.pct + AvgHispanic.pct + AvgMedian.Income + AvgCollege.Grad.pct + AvgDem2008.pct, data=statedem, family=binomial())

  p.score <- predict(propensitywts, statedem, type = "response")
  df <- statedem
  df$ps <- p.score

  #run model
  statedemanalysis <- df %>% filter(hasdata == 1)

  model_no_dist <- lm(statedemanalysis[[varname]] ~ TotalRestrictions, weights = ps, data = statedemanalysis)
  
  model_dist <- lm(statedemanalysis[[varname]] ~ TotalRestrictions + AvgDistancetoProvider + TotalRestrictions*AvgDistancetoProvider, data = statedemanalysis, weights = ps)
  
  return(list(summary(model_no_dist), summary(model_dist)))
}

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
returns <- stateanalysis("AvgAbortionRate2010")
model_no_dist <- returns[[1]]
model_dist <- returns[[2]]

p <- model_no_dist$coefficients[2,4] %>% round(3)
# Model Summaries
table_no_dist <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = model_no_dist$coefficients[2]*1000,
                  "95% CI lower" = model_no_dist$coefficients[2,1]*1000-model_no_dist$coefficients[2,2]*1000*1.96,
                  "95% CI upper" = model_no_dist$coefficients[2,1]*1000+model_no_dist$coefficients[2,2]*1000*1.96,
                  "p-value" = c(p)) %>% 
  kbl(caption = "State Data: Abortion Rate per 1,000 Women, in Model without Distances", 
          digits = 4) %>%
  kable_styling(latex_options = 'hold_position')
table_no_dist

p_1 <- model_dist$coefficients[2,4] %>% round(3)
p_2 <- model_dist$coefficients[3,4] %>% round(3)
p_3 <- model_dist$coefficients[4,4] %>% round(3)

table_dist <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2]*1000, 
                           model_dist$coefficients[3]*1000,
                           model_dist$coefficients[4]*1000),
                  "95% CI lower" = c(model_dist$coefficients[2,1]*1000-model_dist$coefficients[2,2]*1000*1.96,
                                     model_dist$coefficients[3,1]*1000-model_dist$coefficients[3,2]*1000*1.96,
                                     model_dist$coefficients[4,1]*1000-model_dist$coefficients[4,2]*1000*1.96),
                  "95% CI upper" = c(model_dist$coefficients[2,1]*1000+model_dist$coefficients[2,2]*1000*1.96,
                                     model_dist$coefficients[3,1]*1000+model_dist$coefficients[3,2]*1000*1.96,
                                     model_dist$coefficients[4,1]*1000+model_dist$coefficients[4,2]*1000*1.96),
                  "p-value" = c(p_1, p_2, p_3)) %>%
  kbl(caption = "State Data: Change in Abortion Rate per 1,000 Women in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_dist
```
### Extension to Infant Death Rate, Birth Rate, and Fertility Rate
We found positive associations between abortion restrictions and both birth rates and fertility rates (see Tables 9-12), however these associations were not statistically significant after adjusting for distance to providers, with p-values > 0.5.  Infant mortality rates were positively associated with abortion restrictions, and these associations were statistically significant even after adjusting for distance from providers (see Tables 13 and 14) .  The maternal and fetal mortality rates were not statistically significant (see Tables 15-18). 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
### State Birth Rate
returns <- stateanalysis("Birth.Rate")
model_no_dist <- returns[[1]]
model_dist <- returns[[2]]

p <- model_no_dist$coefficients[2,4] %>% round(3)
# Model Summaries
table_9 <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = model_no_dist$coefficients[2],
                  "95% CI lower" = model_no_dist$coefficients[2,1]-model_no_dist$coefficients[2,2]*1.96,
                  "95% CI upper" = model_no_dist$coefficients[2,1]+model_no_dist$coefficients[2,2]*1.96,
                  "p-value" = c(p)) %>% 
  kbl(caption = "State Data: Change in Birth Rate per 1,000 People, in Model without Distances", 
          digits = 4) %>%
  kable_styling(latex_options = 'hold_position')
table_9

p_1 <- model_dist$coefficients[2,4] %>% round(3)
p_2 <- model_dist$coefficients[3,4] %>% round(3)
p_3 <- model_dist$coefficients[4,4] %>% round(3)

table_10 <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2], 
                           model_dist$coefficients[3],
                           model_dist$coefficients[4]),
                  "95% CI lower" = c(model_dist$coefficients[2,1]-model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]-model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]-model_dist$coefficients[4,2]*1.96),
                  "95% CI upper" = c(model_dist$coefficients[2,1]+model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]+model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]+model_dist$coefficients[4,2]*1.96),
                  "p-value" = c(p_1, p_2, p_3)) %>%
  kbl(caption = "State Data: Change in Birth Rate per 1,000 People, in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_10
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
### State Fertility Rate
returns <- stateanalysis("Fertility.Rate")
model_no_dist <- returns[[1]]
model_dist <- returns[[2]]

p <- model_no_dist$coefficients[2,4] %>% round(3)
# Model Summaries
table_no_dist <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = model_no_dist$coefficients[2],
                  "95% CI lower" = model_no_dist$coefficients[2,1]-model_no_dist$coefficients[2,2]*1.96,
                  "95% CI upper" = model_no_dist$coefficients[2,1]+model_no_dist$coefficients[2,2]*1.96,
                  "p-value" = c(p)) %>% 
  kbl(caption = "State Data: Change in Fertility Rate per 1,000 Women, in Model without Distances", 
          digits = 4) %>%
  kable_styling(latex_options = 'hold_position')
table_no_dist

p_1 <- model_dist$coefficients[2,4] %>% round(3)
p_2 <- model_dist$coefficients[3,4] %>% round(3)
p_3 <- model_dist$coefficients[4,4] %>% round(3)

table_dist <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2], 
                           model_dist$coefficients[3],
                           model_dist$coefficients[4]),
                  "95% CI lower" = c(model_dist$coefficients[2,1]-model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]-model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]-model_dist$coefficients[4,2]*1.96),
                  "95% CI upper" = c(model_dist$coefficients[2,1]+model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]+model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]+model_dist$coefficients[4,2]*1.96),
                  "p-value" = c(p_1, p_2, p_3)) %>%
  kbl(caption = "State Data: Change in Fertility Rate per 1,000 Women, in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_dist
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
### State  Infant Death Rate
returns <- stateanalysis("Death.Rate")
model_no_dist <- returns[[1]]
model_dist <- returns[[2]]

# p <- model_no_dist$coefficients[2,4] %>% round(3)
# Model Summaries
table_no_dist <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = model_no_dist$coefficients[2],
                  "95% CI lower" = model_no_dist$coefficients[2,1]-model_no_dist$coefficients[2,2]*1.96,
                  "95% CI upper" = model_no_dist$coefficients[2,1]+model_no_dist$coefficients[2,2]*1.96,
                  "p-value" = '< 0.001') %>% 
  kbl(caption = "State Data: Change in Infant Deaths per 1,000 Total Deaths, in Model without Distances", 
          digits = 4) %>%
  kable_styling(latex_options = 'hold_position')
table_no_dist

# p_1 <- model_dist$coefficients[2,4] %>% round(3)
p_2 <- model_dist$coefficients[3,4] %>% round(3)
p_3 <- model_dist$coefficients[4,4] %>% round(3)

table_dist <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2], 
                           model_dist$coefficients[3],
                           model_dist$coefficients[4]),
                  "95% CI lower" = c(model_dist$coefficients[2,1]-model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]-model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]-model_dist$coefficients[4,2]*1.96),
                  "95% CI upper" = c(model_dist$coefficients[2,1]+model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]+model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]+model_dist$coefficients[4,2]*1.96),
                  "p-value" = c('< 0.001', p_2, p_3)) %>%
  kbl(caption = "State Data: Change in Infant Deaths per 1,000 Total Deaths, in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_dist
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

### State Fetal Death Percent
returns <- stateanalysis("Pct.Fetal.Deaths")
model_no_dist <- returns[[1]]
model_dist <- returns[[2]]

p <- model_no_dist$coefficients[2,4] %>% round(3)
# Model Summaries
table_no_dist <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = model_no_dist$coefficients[2],
                  "95% CI lower" = model_no_dist$coefficients[2,1]-model_no_dist$coefficients[2,2]*1.96,
                  "95% CI upper" = model_no_dist$coefficients[2,1]+model_no_dist$coefficients[2,2]*1.96,
                  "p-value" = p) %>% 
  kbl(caption = "State Data: Change in Fetal Deaths per 1,000 Total Deaths, in Model without Distances", 
          digits = 4) %>%
  kable_styling(latex_options = 'hold_position')
table_no_dist

p_1 <- model_dist$coefficients[2,4] %>% round(3)
p_2 <- model_dist$coefficients[3,4] %>% round(3)
p_3 <- model_dist$coefficients[4,4] %>% round(3)

table_dist <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2], 
                           model_dist$coefficients[3],
                           model_dist$coefficients[4]),
                  "95% CI lower" = c(model_dist$coefficients[2,1]-model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]-model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]-model_dist$coefficients[4,2]*1.96),
                  "95% CI upper" = c(model_dist$coefficients[2,1]+model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]+model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]+model_dist$coefficients[4,2]*1.96),
                  "p-value" = c(p_1, p_2, p_3)) %>%
  kbl(caption = "State Data: Change in Fetal Deaths per 1,000 Total Deaths, in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_dist
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
### State Maternal Deaths
returns <- stateanalysis("Pct.Maternal.Deaths")
model_no_dist <- returns[[1]]
model_dist <- returns[[2]]

p <- model_no_dist$coefficients[2,4] %>% round(3)
# Model Summaries
table_no_dist <- tibble(Characteristic = "Count of Types of Restrictions",
                  Beta = model_no_dist$coefficients[2],
                  "95% CI lower" = model_no_dist$coefficients[2,1]-model_no_dist$coefficients[2,2]*1.96,
                  "95% CI upper" = model_no_dist$coefficients[2,1]+model_no_dist$coefficients[2,2]*1.96,
                  "p-value" = p) %>% 
  kbl(caption = "State Data: Change in Maternal Deaths per 1,000 Total Deaths, in Model without Distances", 
          digits = 4) %>%
  kable_styling(latex_options = 'hold_position')
table_no_dist

p_1 <- model_dist$coefficients[2,4] %>% round(3)
p_2 <- model_dist$coefficients[3,4] %>% round(3)
p_3 <- model_dist$coefficients[4,4] %>% round(3)

table_dist <- tibble(Characteristic = c("Count of Types of Restrictions", "Distance to Provider",
                                     "Distance/Restriction Interaction"),
                  Beta = c(model_dist$coefficients[2], 
                           model_dist$coefficients[3],
                           model_dist$coefficients[4]),
                  "95% CI lower" = c(model_dist$coefficients[2,1]-model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]-model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]-model_dist$coefficients[4,2]*1.96),
                  "95% CI upper" = c(model_dist$coefficients[2,1]+model_dist$coefficients[2,2]*1.96,
                                     model_dist$coefficients[3,1]+model_dist$coefficients[3,2]*1.96,
                                     model_dist$coefficients[4,1]+model_dist$coefficients[4,2]*1.96),
                  "p-value" = c(p_1, p_2, p_3)) %>%
  kbl(caption = "State Data: Change in Maternal Deaths per 1,000 Total Deaths, in Model with Distances") %>%
  kable_styling(latex_options = 'hold_position')
table_dist
```

\newpage


### Conclusions & Relevance
Our analysis confirms the results of Brown et al. showing a negative association between restrictive abortion legislation and abortion rates based on both the 18 states they analyized and based on data from all 50 states.  We furthered the analysis to additional outcomes and found positive associations between restrictions and infant death rates, while restrictions do not have a significant association with birth rates or maternal or fetal mortality rates after adjusting for distance to providers. Ultimately, this suggests that while highly restrictive legislation might significantly decrease abortion rates, as shown by Brown et al., such legislation does not actually significantly increase birth rates and actually increases infant death rates. This conclusion ultimately suggests that policies enforcing strict legislation on abortion restrictions would most likely be ineffective at increasing populations - while abortions decrease, births do not increase, suggesting that pregnancies may be terminated or prevented in other ways, and infant deaths actually increase. All together, highly restrictive legislation appears to have negative consequences on populations across the United States: such legislation reduces accessibility to important healthcare, may cause less-safe abortions that are not performed in medical clinics, and may result in more babies being born who are very sick.

## Limitations

The main limitations of these analyses are due to missing data. Both the original analysis and our replication of this analysis are limited by the use of data from only 18 states.  We addressed this shortcoming in our extension, though our extension still does not have data for all states and/or all counties. Further, our replication of the original analysis as well as our extensions and expansions of said analysis are limited by the fact that state-level legislative data is only available for the years 2000, 2010, and 2020. More detailed legislative information is available for more recent years (roughly 2018 to the present), but abortion count data for these years is not yet released. Further analyses with more recent, detailed legislative data and abortion counts from more recent years would greatly add to the present analyses and could also allow for a more longitudinal approach. The original analysis and our own are also limited by the fact that abortion rates are calculated using total number of women, rather than number of women of reproductive age - this is due to the lack of data on population statistics stratified by age. Further, the data used in our extension is only by state, rather than by county, as previously discussed, due to suppression of data for the purpose of preserving anonymity. As a final note, the nature of abortion, mortality, fertility, and birth data is limited by the fact that not all of these occurrences are reported, and, if they are, not all ofthem are reported with complete accuracy (for example, it's possible that the abortion rates is much higher than those reported in the datasets and that women do not report all abortions) due to the sensitive nature of such data.


## Sources

Austin N, Harper S. "Assessing the impact of TRAP laws on abortion and women’s health in the USA: a systematic review" BMJ Sex Reprod Health, 2018; 44:128–134.

Edwards, E. "States pushing abortion bans have higher infant mortality rates". NBC News Website, 2019. Available at https://www.nbcnews.com/health/womens-health/states-pushing-abortion-bans-have-higher-infant-mortality-rates-n1008481. Accessed 12/14/21.

Centers for Disease Control and Prevention, National Center for Health Statistics. Compressed Mortality File 1999-2016 on CDC WONDER Online Database, released June 2017. Data are from the Compressed Mortality File 1999-2016 Series 20 No. 2U, 2016, as compiled from data provided by the 57 vital statistics jurisdictions through the Vital Statistics Cooperative Program. Accessed at http://wonder.cdc.gov/cmf-icd10.html on Dec 15, 2021 9:43:02 PM

Nikolova, M. "When will conservatives learn that banning abortion does little to address demographic decline?" Emerging Europe website, 2020.  Available at https://emerging-europe.com/after-hours/when-will-conservatives-learn-that-banning-abortion-does-little-to-address-demographic-decline/. Accessed 12/14/21.

Redd, Sara K.; Stidham Hall, Kelli; Aswani, Monica S.; Sen, Bisakha; Wingate, Martha; Rice, Whitney S.  "Variation in Restrictive Abortion Policies and Adverse Birth Outcomes in the United States from 2005 to 2015" Women's Health Issues, 2021 1-11.

Stevenson, A. J. "The Pregnancy-Related Mortality Impact of a Total Abortion Ban in the United States: A Research Note on Increased
Deaths Due to Remaining Pregnant" Demography (2021) 58(6):2019–2028.

United States Department of Health and Human Services (US DHHS), Centers for Disease Control and Prevention (CDC), National Center for Health Statistics (NCHS), Division of Vital Statistics (DVS). Fetal Deaths 2005-2019, as compiled from data provided by the 57 vital statistics jurisdictions through the Vital Statistics Cooperative Program, on CDC WONDER Online Database. Accessed at http://wonder.cdc.gov/fetal-deaths-current.html on Dec 15, 2021 9:45:49 PM

United States Department of Health and Human Services (US DHHS), Centers of Disease Control and Prevention (CDC), National Center for Health Statistics (NCHS), Division of Vital Statistics (DVS). Linked Birth / Infant Death Records 2007-2018, as compiled from data provided by the 57 vital statistics jurisdictions through the Vital Statistics Cooperative Program, on CDC WONDER On-line Database. Accessed at http://wonder.cdc.gov/lbd-current.html on Dec 15, 2021 8:57:30 PM

United States Department of Health and Human Services (US DHHS), Centers for Disease Control and Prevention (CDC), National Center for Health Statistics (NCHS), Division of Vital Statistics, Natality public-use data 2007-2020, on CDC WONDER Online Database, October 2021. Accessed at http://wonder.cdc.gov/natality-current.html on Dec 15, 2021 9:45:00 PM

Data on the county population centroids came from the United States Census Bureau.
Available at https://www.census.gov/geographies/reference-files/time-series/geo/centers-population.html Accessed 12/11/21.

Data on the county-level voting totals came from the Harvard Dataverse.
Available at https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/VOQCHQ. Accessed 12/13/21. 


## Code Appendix
```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```
